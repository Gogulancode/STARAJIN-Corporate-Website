<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starajin CMS - Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'starajin-blue': '#224288',
                        'starajin-orange': '#feb25a',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen" x-data="adminApp()" x-init="init()">
    <!-- Topbar -->
    <nav class="bg-white shadow-sm border-b sticky top-0 z-40">
        <div class="px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <!-- Left: Breadcrumb & Title -->
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2 text-sm text-gray-600">
                        <span>CMS</span>
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        <span x-text="currentSection"></span>
                        <template x-if="currentPage">
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                                </svg>
                                <span x-text="currentPage?.title || currentPage?.key"></span>
                            </div>
                        </template>
                    </div>
                    <h1 class="text-xl font-semibold text-gray-900" x-text="pageTitle"></h1>
                </div>

                <!-- Right: Action Buttons -->
                <div class="flex items-center space-x-4">
                    <!-- Locale Select -->
                    <select x-model="currentLocale" @change="switchLocale()" 
                            class="border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-starajin-blue">
                        <option value="en">🇺🇸 EN</option>
                        <option value="ko">🇰🇷 KR</option>
                    </select>

                    <!-- Action Buttons -->
                    <template x-if="currentPage">
                        <div class="flex items-center space-x-2">
                            <button @click="savePage()" :disabled="saving" 
                                    class="bg-gray-600 hover:bg-gray-700 disabled:opacity-50 text-white px-4 py-2 rounded-md text-sm flex items-center">
                                <span x-show="!saving">Save</span>
                                <span x-show="saving" class="flex items-center">
                                    <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    Saving...
                                </span>
                            </button>
                            
                            <button @click="publishPage()" :disabled="publishing" 
                                    class="bg-starajin-blue hover:bg-starajin-blue/90 disabled:opacity-50 text-white px-4 py-2 rounded-md text-sm flex items-center">
                                <span x-show="!publishing">Publish</span>
                                <span x-show="publishing">Publishing...</span>
                            </button>
                            
                            <button @click="previewPage()" 
                                    class="bg-starajin-orange hover:bg-starajin-orange/90 text-white px-4 py-2 rounded-md text-sm">
                                Preview
                            </button>
                        </div>
                    </template>

                    <!-- User Menu -->
                    <div class="flex items-center space-x-2">
                        <span class="text-sm text-gray-600" x-text="'Welcome, ' + user.email"></span>
                        <button @click="logout()" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-md text-sm">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Layout Grid -->
    <div class="flex h-[calc(100vh-4rem)]">
        <!-- Left Sidebar (320px, sticky) -->
        <aside class="w-80 bg-white shadow-sm border-r overflow-y-auto">
            <!-- Navigation -->
            <nav class="p-4 border-b">
                <ul class="space-y-2">
                    <li>
                        <button @click="navigateTo('pages')" 
                                :class="currentSection === 'pages' ? 'bg-starajin-blue text-white' : 'text-gray-700 hover:bg-gray-100'"
                                class="w-full flex items-center px-3 py-2 rounded-md text-sm font-medium">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Pages
                        </button>
                    </li>
                    <li>
                        <button @click="navigateTo('menus')" 
                                :class="currentSection === 'menus' ? 'bg-starajin-blue text-white' : 'text-gray-700 hover:bg-gray-100'"
                                class="w-full flex items-center px-3 py-2 rounded-md text-sm font-medium">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                            Menus
                        </button>
                    </li>
                    <li>
                        <button @click="navigateTo('media')" 
                                :class="currentSection === 'media' ? 'bg-starajin-blue text-white' : 'text-gray-700 hover:bg-gray-100'"
                                class="w-full flex items-center px-3 py-2 rounded-md text-sm font-medium">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            Media
                        </button>
                    </li>
                    <li>
                        <button @click="navigateTo('translations')" 
                                :class="currentSection === 'translations' ? 'bg-starajin-blue text-white' : 'text-gray-700 hover:bg-gray-100'"
                                class="w-full flex items-center px-3 py-2 rounded-md text-sm font-medium">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"></path>
                            </svg>
                            Translations
                        </button>
                    </li>
                    <li>
                        <button @click="navigateTo('settings')" 
                                :class="currentSection === 'settings' ? 'bg-starajin-blue text-white' : 'text-gray-700 hover:bg-gray-100'"
                                class="w-full flex items-center px-3 py-2 rounded-md text-sm font-medium">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            Settings
                        </button>
                    </li>
                </ul>
            </nav>

            <!-- Section-specific Sidebar Content -->
            <div class="p-4">
                <!-- Pages Section -->
                <template x-if="currentSection === 'pages'">
                    <div>
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-medium text-gray-900">Pages</h3>
                            <button @click="createPage()" class="text-starajin-blue hover:text-starajin-blue/80 text-sm">
                                + Add Page
                            </button>
                        </div>
                        <ul class="space-y-2">
                            <template x-for="page in pages" :key="page.id">
                                <li>
                                    <button @click="editPage(page)" 
                                            :class="currentPage?.id === page.id ? 'bg-starajin-blue/10 border-starajin-blue text-starajin-blue' : 'border-gray-200 text-gray-700 hover:bg-gray-50'"
                                            class="w-full text-left px-3 py-2 rounded-md border text-sm">
                                        <div class="flex items-center justify-between">
                                            <span x-text="page.title || page.key"></span>
                                            <span :class="page.isEnabled ? 'text-green-600' : 'text-gray-400'" 
                                                  class="text-xs">
                                                <span x-text="page.isEnabled ? '●' : '○'"></span>
                                            </span>
                                        </div>
                                    </button>
                                </li>
                            </template>
                        </ul>
                    </div>
                </template>

                <!-- Page Editor Sidebar -->
                <template x-if="currentSection === 'pages' && currentPage && editMode">
                    <div class="border-t pt-4 mt-4">
                        <h4 class="font-medium text-gray-900 mb-4">Page Settings</h4>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Page Title</label>
                                <input type="text" 
                                       :value="currentPageTranslation?.title || ''"
                                       @input="updatePageTitle($event.target.value)"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-starajin-blue focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Meta Description</label>
                                <textarea rows="3"
                                          :value="currentPageTranslation?.seoDesc || ''"
                                          @input="updatePageSeoDesc($event.target.value)"
                                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-starajin-blue focus:border-transparent"></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                <select :value="currentPage?.isEnabled || false"
                                        @change="updatePageStatus($event.target.value)"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-starajin-blue focus:border-transparent">
                                    <option value="false">Draft</option>
                                    <option value="true">Published</option>
                                </select>
                            </div>

                            <div class="pt-4 border-t text-sm text-gray-600">
                                <p><strong>Page Key:</strong> <span x-text="currentPage?.key"></span></p>
                                <p><strong>Sections:</strong> <span x-text="sections.length"></span></p>
                                <p><strong>Last Updated:</strong> <span x-text="currentPage ? new Date(currentPage.updatedAt).toLocaleDateString() : ''"></span></p>
                            </div>

                            <!-- Import Button -->
                            <div class="pt-4 border-t">
                                <button @click="openImportModal()" 
                                        class="w-full bg-starajin-orange hover:bg-starajin-orange/90 text-white px-4 py-2 rounded-md text-sm">
                                    Import Existing Content
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </aside>

        <!-- Center Content Area -->
        <main class="flex-1 overflow-y-auto p-6">
            <!-- Pages List View -->
            <template x-if="currentSection === 'pages' && !editMode">
                <div>
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900">Pages</h2>
                        <p class="text-gray-600">Manage your website pages and content</p>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Page</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sections</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Updated</th>
                                    <th class="relative px-6 py-3"><span class="sr-only">Actions</span></th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="page in pages" :key="page.id">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div>
                                                <div class="text-sm font-medium text-gray-900" x-text="page.title || page.key"></div>
                                                <div class="text-sm text-gray-500" x-text="page.slug"></div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span :class="page.isEnabled ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'" 
                                                  class="inline-flex px-2 py-1 text-xs font-semibold rounded-full">
                                                <span x-text="page.isEnabled ? 'Published' : 'Draft'"></span>
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <span x-text="page.sections?.length || 0"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <span x-text="new Date(page.updatedAt).toLocaleDateString()"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <button @click="editPage(page)" class="text-starajin-blue hover:text-starajin-blue/80">Edit</button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </template>

            <!-- Page Editor View -->
            <template x-if="currentSection === 'pages' && editMode && currentPage">
                <div>
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-900">Page Sections</h2>
                        <p class="text-gray-600">Manage sections for <span x-text="currentPage.title || currentPage.key"></span></p>
                    </div>

                    <!-- Add Section Button -->
                    <div class="mb-6">
                        <div class="relative" x-data="{ open: false }">
                            <button @click="open = !open" 
                                    class="bg-starajin-blue hover:bg-starajin-blue/90 text-white px-4 py-2 rounded-md text-sm flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                Add Section
                            </button>
                            
                            <div x-show="open" @click.away="open = false" 
                                 class="absolute z-10 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5">
                                <div class="py-1">
                                    <button @click="addSection('hero'); open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Hero</button>
                                    <button @click="addSection('text_image'); open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Text + Image</button>
                                    <button @click="addSection('text'); open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Text</button>
                                    <button @click="addSection('stats'); open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Achievements</button>
                                    <button @click="addSection('image'); open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">News</button>
                                    <button @click="addSection('cta'); open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">CTA</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sections List -->
                    <div class="space-y-4">
                        <template x-for="(section, index) in sections" :key="section.id || section.tempId">
                            <div class="bg-white rounded-lg shadow border">
                                <!-- Section Header -->
                                <div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <!-- Type Badge -->
                                        <span :class="getSectionBadgeColor(section.type)" 
                                              class="inline-flex px-2 py-1 text-xs font-semibold rounded-full">
                                            <span x-text="formatSectionType(section.type)"></span>
                                        </span>
                                        
                                        <!-- Enable Toggle -->
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" 
                                                   :checked="section.isEnabled"
                                                   @change="toggleSectionEnabled(section, $event.target.checked)"
                                                   class="sr-only">
                                            <div :class="section.isEnabled ? 'bg-starajin-blue' : 'bg-gray-300'" 
                                                 class="relative inline-flex h-5 w-9 rounded-full transition-colors duration-200 ease-in-out">
                                                <span :class="section.isEnabled ? 'translate-x-4' : 'translate-x-0'" 
                                                      class="inline-block h-4 w-4 mt-0.5 ml-0.5 rounded-full bg-white transition-transform duration-200 ease-in-out"></span>
                                            </div>
                                            <span class="ml-2 text-sm text-gray-700">Enabled</span>
                                        </label>
                                    </div>

                                    <div class="flex items-center space-x-2">
                                        <!-- Move Up/Down -->
                                        <button @click="moveSectionUp(index)" :disabled="index === 0" 
                                                class="p-1 text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                                            </svg>
                                        </button>
                                        <button @click="moveSectionDown(index)" :disabled="index === sections.length - 1" 
                                                class="p-1 text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                            </svg>
                                        </button>
                                        
                                        <!-- Duplicate -->
                                        <button @click="duplicateSection(section)" 
                                                class="p-1 text-gray-400 hover:text-gray-600">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                            </svg>
                                        </button>
                                        
                                        <!-- Delete -->
                                        <button @click="deleteSection(section)" 
                                                class="p-1 text-red-400 hover:text-red-600">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <!-- Section Content Editor -->
                                <div class="p-4" x-data="{ expanded: true }">
                                    <button @click="expanded = !expanded" 
                                            class="w-full flex items-center justify-between text-left mb-4">
                                        <span class="font-medium text-gray-900">Section Content</span>
                                        <svg :class="expanded ? 'rotate-180' : ''" class="w-4 h-4 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </button>

                                    <div x-show="expanded" class="space-y-4">
                                        <!-- Type-specific editors will be implemented here -->
                                        <div x-html="renderSectionEditor(section)"></div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </template>

            <!-- Other sections (Menus, Media, etc.) will be placeholder for now -->
            <template x-if="currentSection !== 'pages' || (currentSection === 'pages' && !editMode && pages.length === 0)">
                <div class="text-center py-12">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2" x-text="formatSectionType(currentSection)"></h2>
                    <p class="text-gray-600">This section is under development</p>
                </div>
            </template>
        </main>

        <!-- Right Preview Pane (440px, sticky) -->
        <aside class="w-110 bg-gray-100 border-l overflow-y-auto" x-show="showPreview">
            <div class="p-4">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-medium text-gray-900">Live Preview</h3>
                    <div class="flex items-center space-x-2">
                        <!-- Device width pills -->
                        <div class="flex border rounded-md overflow-hidden">
                            <button @click="previewDevice = 'mobile'" 
                                    :class="previewDevice === 'mobile' ? 'bg-starajin-blue text-white' : 'bg-white text-gray-700'"
                                    class="px-2 py-1 text-xs">📱</button>
                            <button @click="previewDevice = 'tablet'" 
                                    :class="previewDevice === 'tablet' ? 'bg-starajin-blue text-white' : 'bg-white text-gray-700'"
                                    class="px-2 py-1 text-xs">📱</button>
                            <button @click="previewDevice = 'desktop'" 
                                    :class="previewDevice === 'desktop' ? 'bg-starajin-blue text-white' : 'bg-white text-gray-700'"
                                    class="px-2 py-1 text-xs">🖥️</button>
                        </div>
                        
                        <button @click="showPreview = false" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Preview Content -->
                <div :class="getPreviewContainerClass()" class="bg-white rounded-lg shadow-sm border mx-auto">
                    <div class="p-4 space-y-6">
                        <template x-for="section in sections.filter(s => s.isEnabled)" :key="section.id || section.tempId">
                            <div x-html="renderSectionPreview(section)"></div>
                        </template>
                        
                        <template x-if="sections.filter(s => s.isEnabled).length === 0">
                            <div class="text-center py-8 text-gray-500">
                                <p>No sections enabled for preview</p>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Import Modal -->
    <div x-show="showImportModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto" 
         @click="showImportModal = false">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75"></div>

            <div @click.stop 
                 class="inline-block w-full max-w-2xl p-6 my-8 text-left align-middle transition-all transform bg-white shadow-xl rounded-lg">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Import Existing Content</h3>
                    <button @click="showImportModal = false" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" x-model="importDryRun" class="rounded border-gray-300 text-starajin-blue">
                            <span class="ml-2 text-sm text-gray-700">Dry Run (preview changes without importing)</span>
                        </label>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Import Method</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" x-model="importMethod" value="existing" class="text-starajin-blue">
                                <span class="ml-2 text-sm">Import from existing frontend structure</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" x-model="importMethod" value="json" class="text-starajin-blue">
                                <span class="ml-2 text-sm">Upload JSON file</span>
                            </label>
                        </div>
                    </div>

                    <div x-show="importMethod === 'json'">
                        <label class="block text-sm font-medium text-gray-700 mb-2">JSON Content</label>
                        <textarea x-model="importJsonContent" 
                                  rows="10" 
                                  placeholder="Paste your JSON content here..."
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-starajin-blue"></textarea>
                    </div>

                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        <button @click="showImportModal = false" 
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">
                            Cancel
                        </button>
                        <button @click="executeImport()" 
                                :disabled="importing"
                                class="px-4 py-2 text-sm font-medium text-white bg-starajin-blue rounded-md hover:bg-starajin-blue/90 disabled:opacity-50">
                            <span x-show="!importing" x-text="importDryRun ? 'Preview Changes' : 'Import Content'"></span>
                            <span x-show="importing">Importing...</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div x-show="message" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform translate-y-2"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 transform translate-y-0"
         x-transition:leave-end="opacity-0 transform translate-y-2"
         class="fixed bottom-4 right-4 z-50">
        <div :class="messageType === 'error' ? 'bg-red-50 border-red-200 text-red-800' : 'bg-green-50 border-green-200 text-green-800'" 
             class="px-4 py-3 rounded-md border shadow-sm flex items-center">
            <svg x-show="messageType === 'success'" class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
            </svg>
            <svg x-show="messageType === 'error'" class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
            <span x-text="message"></span>
        </div>
    </div>

    <script>
        function adminApp() {
            return {
                // Core state
                user: {},
                currentSection: 'pages',
                currentPage: null,
                currentPageTranslation: null,
                currentLocale: 'en',
                editMode: false,
                pageTitle: 'Dashboard',
                
                // Data
                pages: [],
                sections: [],
                
                // UI state
                loading: false,
                saving: false,
                publishing: false,
                importing: false,
                showPreview: true,
                previewDevice: 'desktop',
                showImportModal: false,
                importDryRun: false,
                importMethod: 'existing',
                importJsonContent: '',
                
                // Messages
                message: '',
                messageType: 'success',

                // Initialization
                init() {
                    // Check authentication
                    const token = localStorage.getItem('cms_token');
                    const userData = localStorage.getItem('cms_user');
                    
                    if (!token || !userData) {
                        window.location.href = '/';
                        return;
                    }
                    
                    this.user = JSON.parse(userData);
                    this.loadPages();
                    
                    // Check URL params for initial state
                    const urlParams = new URLSearchParams(window.location.search);
                    const pageKey = urlParams.get('page');
                    if (pageKey) {
                        this.loadPageByKey(pageKey);
                    }
                },

                // Navigation
                navigateTo(section) {
                    this.currentSection = section;
                    this.editMode = false;
                    this.currentPage = null;
                    this.sections = [];
                    this.updatePageTitle();
                    this.updateUrl();
                },

                updatePageTitle() {
                    if (this.editMode && this.currentPage) {
                        this.pageTitle = `Edit: ${this.currentPage.title || this.currentPage.key}`;
                    } else {
                        this.pageTitle = this.formatSectionType(this.currentSection);
                    }
                },

                updateUrl() {
                    const url = new URL(window.location);
                    if (this.editMode && this.currentPage) {
                        url.searchParams.set('page', this.currentPage.key);
                    } else {
                        url.searchParams.delete('page');
                    }
                    window.history.pushState({}, '', url);
                },

                // API calls
                async loadPages() {
                    try {
                        this.loading = true;
                        const response = await fetch('http://localhost:3004/api/pages');
                        const data = await response.json();
                        
                        if (data.success) {
                            this.pages = data.data;
                        }
                    } catch (error) {
                        this.showMessage('Error loading pages: ' + error.message, 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                async loadPageByKey(pageKey) {
                    try {
                        const response = await fetch(`http://localhost:3004/api/pages?key=${pageKey}`);
                        const data = await response.json();
                        
                        if (data.success && data.data.length > 0) {
                            this.editPage(data.data[0]);
                        }
                    } catch (error) {
                        this.showMessage('Error loading page: ' + error.message, 'error');
                    }
                },

                // Page operations
                editPage(page) {
                    this.currentPage = page;
                    this.currentPageTranslation = page.translations?.find(t => t.locale === this.currentLocale) || {};
                    this.editMode = true;
                    this.loadSections();
                    this.updatePageTitle();
                    this.updateUrl();
                },

                loadSections() {
                    if (this.currentPage.sections && this.currentPage.sections.length > 0) {
                        this.sections = this.currentPage.sections.map(section => ({
                            id: section.id,
                            type: section.type,
                            sortOrder: section.sortOrder,
                            isEnabled: section.isEnabled,
                            config: section.config || {},
                            content: section.translations?.find(t => t.locale === this.currentLocale)?.content || this.getDefaultContent(section.type)
                        }));
                    } else {
                        this.sections = [];
                    }
                },

                getDefaultContent(type) {
                    const defaults = {
                        hero: { slides: [{ title: '', subtitle: '', description: '', buttonText: '', buttonLink: '' }] },
                        text_image: { title: '', subtitle: '', description: '', imageUrl: '' },
                        text: { title: '', subtitle: '', description: '' },
                        stats: { title: '', subtitle: '', categories: [] },
                        image: { title: '', subtitle: '', logos: [] },
                        cta: { title: '', subtitle: '', description: '', buttonText: '', buttonLink: '' }
                    };
                    return defaults[type] || {};
                },

                // Section operations
                addSection(type) {
                    const newSection = {
                        tempId: 'temp_' + Date.now(),
                        type: type,
                        sortOrder: this.sections.length,
                        isEnabled: true,
                        config: {},
                        content: this.getDefaultContent(type)
                    };
                    
                    this.sections.push(newSection);
                },

                deleteSection(section) {
                    if (confirm('Are you sure you want to delete this section?')) {
                        const index = this.sections.findIndex(s => 
                            (s.id && s.id === section.id) || (s.tempId && s.tempId === section.tempId)
                        );
                        if (index !== -1) {
                            this.sections.splice(index, 1);
                        }
                    }
                },

                duplicateSection(section) {
                    const duplicate = {
                        ...section,
                        id: undefined,
                        tempId: 'temp_' + Date.now(),
                        sortOrder: section.sortOrder + 1
                    };
                    
                    const index = this.sections.findIndex(s => 
                        (s.id && s.id === section.id) || (s.tempId && s.tempId === section.tempId)
                    );
                    
                    this.sections.splice(index + 1, 0, duplicate);
                },

                moveSectionUp(index) {
                    if (index > 0) {
                        [this.sections[index], this.sections[index - 1]] = [this.sections[index - 1], this.sections[index]];
                    }
                },

                moveSectionDown(index) {
                    if (index < this.sections.length - 1) {
                        [this.sections[index], this.sections[index + 1]] = [this.sections[index + 1], this.sections[index]];
                    }
                },

                toggleSectionEnabled(section, enabled) {
                    section.isEnabled = enabled;
                },

                // Update functions
                updatePageTitle(value) {
                    if (!this.currentPageTranslation) {
                        this.currentPageTranslation = { locale: this.currentLocale };
                    }
                    this.currentPageTranslation.title = value;
                },

                updatePageSeoDesc(value) {
                    if (!this.currentPageTranslation) {
                        this.currentPageTranslation = { locale: this.currentLocale };
                    }
                    this.currentPageTranslation.seoDesc = value;
                },

                updatePageStatus(value) {
                    if (this.currentPage) {
                        this.currentPage.isEnabled = value === 'true';
                    }
                },

                // Save operations
                async savePage() {
                    if (!this.currentPage) return;
                    
                    try {
                        this.saving = true;
                        
                        const updateData = {
                            title: this.currentPageTranslation?.title || '',
                            seoDesc: this.currentPageTranslation?.seoDesc || '',
                            isEnabled: this.currentPage.isEnabled,
                            sections: this.sections.map((section, index) => ({
                                ...section,
                                sortOrder: index
                            }))
                        };

                        const response = await fetch(`http://localhost:3004/api/pages/${this.currentPage.id}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('cms_token')}`
                            },
                            body: JSON.stringify(updateData)
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            this.showMessage('Page saved successfully!');
                            await this.loadPages(); // Refresh pages list
                        } else {
                            throw new Error(result.error || 'Failed to save page');
                        }
                    } catch (error) {
                        this.showMessage('Error saving page: ' + error.message, 'error');
                    } finally {
                        this.saving = false;
                    }
                },

                async publishPage() {
                    this.currentPage.isEnabled = true;
                    await this.savePage();
                },

                previewPage() {
                    if (this.currentPage) {
                        const previewUrl = `http://localhost:5173/${this.currentPage.slug}`;
                        window.open(previewUrl, '_blank');
                    }
                },

                // Import functionality
                openImportModal() {
                    this.showImportModal = true;
                    this.importDryRun = false;
                    this.importMethod = 'existing';
                    this.importJsonContent = '';
                },

                async executeImport() {
                    if (!this.currentPage) return;
                    
                    try {
                        this.importing = true;
                        
                        if (this.importMethod === 'existing') {
                            const response = await fetch('http://localhost:3004/api/import-home-content', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${localStorage.getItem('cms_token')}`
                                }
                            });
                            
                            const result = await response.json();
                            
                            if (result.success) {
                                this.showMessage('Content imported successfully!');
                                this.showImportModal = false;
                                await this.loadPageByKey(this.currentPage.key);
                            } else {
                                throw new Error(result.error || 'Import failed');
                            }
                        } else {
                            // JSON import logic would go here
                            this.showMessage('JSON import not yet implemented', 'error');
                        }
                    } catch (error) {
                        this.showMessage('Import error: ' + error.message, 'error');
                    } finally {
                        this.importing = false;
                    }
                },

                // Locale switching
                switchLocale() {
                    if (this.currentPage) {
                        this.currentPageTranslation = this.currentPage.translations?.find(t => t.locale === this.currentLocale) || {};
                        this.loadSections(); // Reload sections for new locale
                    }
                },

                // Utility functions
                formatSectionType(type) {
                    const types = {
                        pages: 'Pages',
                        menus: 'Menus', 
                        media: 'Media',
                        translations: 'Translations',
                        settings: 'Settings',
                        hero: 'Hero',
                        text_image: 'Text + Image',
                        text: 'Text',
                        stats: 'Achievements',
                        image: 'News',
                        cta: 'Call to Action'
                    };
                    return types[type] || type;
                },

                getSectionBadgeColor(type) {
                    const colors = {
                        hero: 'bg-purple-100 text-purple-800',
                        text_image: 'bg-blue-100 text-blue-800',
                        text: 'bg-green-100 text-green-800',
                        stats: 'bg-yellow-100 text-yellow-800',
                        image: 'bg-pink-100 text-pink-800',
                        cta: 'bg-red-100 text-red-800'
                    };
                    return colors[type] || 'bg-gray-100 text-gray-800';
                },

                getPreviewContainerClass() {
                    const classes = {
                        mobile: 'max-w-sm',
                        tablet: 'max-w-md',
                        desktop: 'max-w-full'
                    };
                    return classes[this.previewDevice] || 'max-w-full';
                },

                // Section editors and preview (placeholder implementations)
                renderSectionEditor(section) {
                    // This would render type-specific editors
                    return `<div class="p-4 bg-gray-50 rounded border-2 border-dashed border-gray-300">
                        <p class="text-gray-600">Section editor for <strong>${this.formatSectionType(section.type)}</strong> will be implemented here</p>
                        <p class="text-sm text-gray-500 mt-2">Content: ${JSON.stringify(section.content)}</p>
                    </div>`;
                },

                renderSectionPreview(section) {
                    // This would render actual section previews
                    return `<div class="p-4 border rounded">
                        <div class="text-sm text-gray-500 mb-2">${this.formatSectionType(section.type)}</div>
                        <div class="space-y-2">
                            ${section.content.title ? `<h3 class="font-bold">${section.content.title}</h3>` : ''}
                            ${section.content.subtitle ? `<p class="text-gray-600">${section.content.subtitle}</p>` : ''}
                            ${section.content.description ? `<p class="text-sm">${section.content.description}</p>` : ''}
                        </div>
                    </div>`;
                },

                // Messages
                showMessage(text, type = 'success') {
                    this.message = text;
                    this.messageType = type;
                    setTimeout(() => {
                        this.message = '';
                    }, 5000);
                },

                logout() {
                    localStorage.removeItem('cms_token');
                    localStorage.removeItem('cms_user');
                    window.location.href = '/';
                }
            }
        }
    </script>
</body>
</html>
